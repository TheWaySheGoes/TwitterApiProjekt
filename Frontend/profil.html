<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Profil</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

	<style>
		#votesList{
			max-height: 400px;
			overflow:scroll;
			-webkit-overflow-scrolling: touch;
		}
		#timeline{
			height: 450px !important;
			overflow:scroll;
			-webkit-overflow-scrolling: touch;
		}
		#votesSearchField {
			border-bottom-left-radius: 0;
			border-bottom-right-radius: 0;
		}
		#votesSearchField > .list-group-item:first-of-type {
			border-top-right-radius: 0;
			border-top-left-radius: 0;
		}
	</style>

</head>

<body>

	<nav class="navbar navbar-expand-lg navbar-light " style="background-color: #7bbeee;">
		<a class="navbar-brand" href="index.html">Riksdagsledamöter</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNavDropdown">
			<ul class="navbar-nav">
				<li class="nav-item active">
					<a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
				</li>
				<li class="nav-item active">
					<a class="nav-link" href="parti.html">Partier</a>
				</li>
				<li class="nav-item active">
					<a class="nav-link" href="profil.html">Ledarmöten</a>
				</li>
				<li class="nav-item active">
					<a class="nav-link" href="stats.html">Statistik</a>
				</li>
				<li class="nav-item active">
					<a class="nav-link" href="api.html">API</a>
				</li>
				<li class="nav-item active">
					<a class="nav-link" href="http://81.170.225.32:16543">Server<span class="sr-only">(current)</span></a>
				</li>
			</ul>
		</div>
	</nav>

	<div class="container">

		<div class="row justify-content-md-center mt-5">

			<div class="col-md-auto">
				<div class="card" id="parliamentMember" style="width: 18rem;">
					<img class="card-img-top" id="memberPicture" style="max-height: 250px; object-fit: cover;" src="https://newsvoice.se/wp-content/uploads/2016/11/Stefan-Lofven-foto-Kristian-Pohl-Regeringskansliet.png" alt="Card image cap">
					<div class="card-body">
						<h5 class="card-title mb-0" id="memberName">Stefan Löfven (S)</h5>
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item" id="memberRole">Statsminister</li>
					</ul>
					<ul class="list-group list-group-flush">
						<li class="list-group-item" id="email">E-post: </li>
					</ul>
					<div class="card-body">
						<a href="https://twitter.com/swedishpm" class="card-link" id="twitterProfil"><i class="fab fa-twitter"></i> Twitterprofil</a>
					</div>
				</div>
			</div>

			<div class="col-md-auto">
				<div class="card" style="width: 18rem;">
					<div class="card-header">
						Senaste tweets
					</div>

					<div id="timeline">
					</div>

				</div>
			</div>

			<div class="col-md-auto">
				<div class="card" style="width: 18rem; max-height: 27rem;">
					<div class="card-header">
						Statistik
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item" id="memberAge">Ålder: </li>
						<li class="list-group-item" id="valkrets">Valkrets: </li>
						<li class="list-group-item" id="followers">Följare: </li>
						<li class="list-group-item" id="tweets">Tweets: </li>
						<li class="list-group-item" id="tweetsPerDay">Tweets/dag: </li>
					</ul>
				</div>
			</div>

		</div>

		<hr>

		<div class="row justify-content-md-center mt-3">

			<div class="col-md-auto">
				<div class="card" style="width: 18rem; max-height: 27rem;">
					<div class="card-header">
						Voteringar
					</div>
					<input class="form-control my-0 shadow-none py-1 rounded-top" id="votesSearchField" type="text" placeholder="Sök efter votering" aria-label="Search">
					<ul class="list-group list-group-flush" id="votesList">
						<!--<a href="votering.html?id=12345" class="list-group-item">Title</a>-->
					</ul>
				</div>
			</div>

			<div class="col-md-auto">
				<div class="card" style="width: 18rem; max-height: 27rem;">
					<div class="card-header">
						Voterings statistik
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item" id="ja">Ja: </li>
						<li class="list-group-item" id="nej">Nej: </li>
						<li class="list-group-item" id="avstår">Avstår: </li>
						<li class="list-group-item" id="frånvarande">Frånvarande: </li>
					</ul>
				</div>
			</div>

		</div>

	</div>

	<br>
	<br>

	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	<!--<script type="text/javascript" src="main.js"></script>-->
</body>

<script type="text/javascript">
	let params = (new URL(document.location)).searchParams;
	let id = params.get("id");

	if (id != null) {

		let memberUrl = "http://localhost:5000/parliamentMember/" + id;

		$.getJSON(memberUrl, function(data) {

			let firstName = data["firstName"];
			let lastName = data["lastName"];
			let party = data["party"];
			let image = data["image"];
			let birthYear = data["birthYear"];
			let constituency = data["constituency"];
			let email = data["email"];
			let status = data["status"];

			let currentDate = new Date();

			let twitter = data["twitter"];

			if (twitter == undefined) {

				$("#twitterProfil").remove();
				$("#timeline").remove();
				$("#followers").remove();
				$("#tweets").remove();
				$("#tweetsPerDay").remove();

			} else {
				let twitterLink = "https://twitter.com/" + twitter;
				let followers = data["followers"];
				let following = data["following"];
				let likes = data["likes"];
				let nrOfTweets = data["tweets"]

				let createdAt = data["createdAt"];
				let createdAtDate = new Date(createdAt);

				let diff = Math.floor((currentDate.getTime() - createdAtDate.getTime()) / 86400000);
				let tweetsPerDay = nrOfTweets / diff;

				$("#twitterProfil").attr("href", twitterLink);

				$("#timeline").append("<a class=\"twitter-timeline\" href=\"https://twitter.com/" + twitter + "\" data-chrome=\"nofooter noheader\">Tweets by " + twitter + "</a>");

				var s = document.createElement('script');
				s.setAttribute('type', 'text/javascript');
				s.async = true;
				s.src = 'https://platform.twitter.com/widgets.js';
				s.charset = 'utf-8';
				document.getElementById('timeline').appendChild(s);

				$("#followers").append(followers);
				$("#tweets").append(nrOfTweets);

				$("#tweetsPerDay").append(tweetsPerDay);
			}

			$("#memberName").text(firstName + " " + lastName + " (" + party + ")");
			$("#memberPicture").attr("src", image);

			let currentYear = currentDate.getFullYear();
			$("#memberAge").append(currentYear - birthYear);

			$("#memberRole").text(status);

			$("#valkrets").append(constituency);

			$("#email").append("<a href=\"mailto:" + email + "\">" + email + "</a>");

			var ja = 0;
			var nej = 0;
			var avstår = 0;
			var frånvarande = 0;

			let votesArray = data["votes"];

			var votesTitles = [];

			for (var index in votesArray) {
				let aVote = votesArray[index];

				let id = aVote["id"];
				let title = aVote["title"]
				let vote = aVote["vote"];

				$("#votesList").append("<a href=\"votering.html?id=" + id + "\" id='" + id + "' class=\"list-group-item\">" + title + ": " + vote + "</a>");
				votesTitles.push(title);

				if (vote == "Ja") {
					ja++;
				} else if (vote == "Nej") {
					nej++;
				} else if (vote == "Avstår") {
					avstår++;
				} else if (vote == "Frånvarande") {
					frånvarande++;
				}
			}

			$("#ja").append(ja);
			$("#nej").append(nej);
			$("#avstår").append(avstår);
			$("#frånvarande").append(frånvarande);

			$("#votesSearchField").bind("change keyup input",function() {
				let input = $("#votesSearchField").val();
				$("#votesList").children().hide();

				if(input){
					$.each([votesTitles], function(index, value){
						$.each(value, function(key, cell){
							if ((cell.toLowerCase()).includes(input.toLowerCase())){
								$("#" + $("#votesList a:nth-child(" + (key+1)  + ")").attr("id")).show();
							}
						});
					});
				} else {
					$("#votesList").children().show();
				}
			});

		});

	}
</script>

</html>
